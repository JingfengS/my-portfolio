+++
title = '进阶布料仿真：从质点弹簧到 XPBD 动力学'
date = '2026-01-10T01:20:57+09:00'
draft = false
tags = ['图形学', '物理仿真', '性能优化', 'C++']
summary = "加州大学伯克利分校基于C++实现的CS184布料仿真项目，重点拓展 XPBD 算法实现与系统级性能优化。"
description = "深度解析高性能物理仿真工程：基于 C++ 实现扩展基于位置的动力学（XPBD），并针对缓存局部性与并行化处理进行极致优化。"
+++

{{< katex >}}

## 项目概览

下方是使用 **扩展基于位置的动力学 (XPBD)** 算法实现的最终仿真结果。

{{< video src="xpbd-better.webm" autoplay="true" loop="true" muted="true" preload="auto" playsinline="true" caption="极强风力环境下的 XPBD 布料仿真（风力强度：2500）。" >}}

本项目中，我首先构建了一个基础的**质点弹簧系统**，实现了布料与外部物体的碰撞检测及自碰撞处理。同时，我利用 **GLSL** 编写了多款着色器以增强视觉表现力。

### 技术核心：进阶探索与性能优化
我认为本项目的核心竞争力在于**额外技术探索**阶段。在该阶段，我完成了从“功能实现”到“工业级优化”的跨越：

1.  **空气动力学模型改良**：
    * **初始方案**：直接将风力作用于顶点，导致布料运动过于僵硬且缺乏真实感。
    * **改进方案**：实现了基于三角形面片法线的风力模型。通过计算面片朝向与风速的相对关系，并引入**紊流 (Turbulence)** 算法，使布料产生了逼真的起伏和褶皱效果。
2.  **性能诊断与瓶颈分析**：
    基于我的高性能计算 (HPC) 背景，我通过 Profiler 对仿真流程进行了细粒度分析，识别出以下瓶颈：
    * **风力计算开销**：大量向量叉积运算占据了显著的 CPU 耗时。
    * **内存分配瓶颈**：使用 `std::unordered_map` 构建空间哈希时产生的**堆内存分配开销**。
    * **缓存命中率**：空间哈希遍历时的随机内存访问导致了严重的 **Cache Miss (缓存缺失)**。
3.  **针对性优化 (整体性能提升 30%)**：
    * **多线程并行**：将 **OpenMP** 整合到项目中，利用 **OpenMP** 对风力累加和自碰撞检测逻辑进行了并行化改造。
    * **数据结构重构**：将基于节点的哈希表重构为 **Flat Spatial Grid (扁平空间网格)**。通过使用排序后的连续 `std::vector` 存储空间索引，消灭了每帧的堆内存申请，并极大提升了 CPU 缓存局部性。
4.  **XPBD 算法实现**：
    为了解决强风场或高刚度 (\\(k_s\\)) 条件下的数值爆炸问题，我将求解器升级为 **XPBD** 架构。 该算法将约束视为位置投影而非显式力，确保了仿真在极端物理环境下依然具备极高的稳定性。

